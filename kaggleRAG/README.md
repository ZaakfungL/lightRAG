# LightRAGå‡†ç¡®æ€§æµ‹è¯•å·¥å…·

è¿™ä¸ªå·¥å…·ç”¨äºæµ‹è¯•LightRAGåœ¨é—®ç­”ä»»åŠ¡ä¸Šçš„å‡†ç¡®æ€§ï¼ŒåŸºäº`train_QA.csv`æ•°æ®é›†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•LightRAGæŸ¥è¯¢å‡†ç¡®åº¦
- ğŸ“Š å¤šç»´åº¦è¯„ä¼°æŒ‡æ ‡ï¼ˆç­”æ¡ˆç›¸ä¼¼åº¦ã€å‚è€ƒæ–‡çŒ®å‡†ç¡®åº¦ï¼‰
- ğŸ“ è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šå’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ”§ çµæ´»çš„é…ç½®é€‰é¡¹
- ğŸ“‹ å®Œæ•´çš„æ—¥å¿—è®°å½•

## æ–‡ä»¶ç»“æ„

```
kaggleRAG/
â”œâ”€â”€ train_QA.csv                    # æµ‹è¯•æ•°æ®é›†
â”œâ”€â”€ test_lightrag_accuracy.py       # ä¸»è¦æµ‹è¯•è„šæœ¬
â”œâ”€â”€ run_test.sh                     # ç®€åŒ–è¿è¡Œè„šæœ¬
â”œâ”€â”€ README.md                       # ä½¿ç”¨è¯´æ˜
â””â”€â”€ results/                        # æµ‹è¯•ç»“æœè¾“å‡ºç›®å½•
    â”œâ”€â”€ lightrag_test_results_*.csv    # è¯¦ç»†ç»“æœCSV
    â”œâ”€â”€ lightrag_test_statistics_*.json # ç»Ÿè®¡ä¿¡æ¯JSON
    â””â”€â”€ lightrag_full_results_*.json    # å®Œæ•´ç»“æœJSON
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿LightRAG APIæœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
lightrag-server
```

### 2. å®‰è£…ä¾èµ–

```bash
pip3 install requests pandas
```

### 3. è¿è¡Œæµ‹è¯•

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç®€åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

æµ‹è¯•å‰10ä¸ªæ ·æœ¬ï¼š
```bash
./run_test.sh
```

æµ‹è¯•æŒ‡å®šæ•°é‡çš„æ ·æœ¬ï¼š
```bash
./run_test.sh 20
```

æµ‹è¯•å…¨éƒ¨æ ·æœ¬ï¼š
```bash
./run_test.sh all
```

#### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡ŒPythonè„šæœ¬

```bash
python3 test_lightrag_accuracy.py
```

### 4. æŸ¥çœ‹ç»“æœ

æµ‹è¯•å®Œæˆåï¼Œç»“æœä¼šä¿å­˜åœ¨`results/`ç›®å½•ä¸­ï¼š
- `lightrag_test_results_*.csv`: åŒ…å«æ¯ä¸ªé—®é¢˜çš„è¯¦ç»†æµ‹è¯•ç»“æœ
- `lightrag_test_statistics_*.json`: æ€»ä½“ç»Ÿè®¡ä¿¡æ¯
- `lightrag_full_results_*.json`: å®Œæ•´çš„æµ‹è¯•æ•°æ®

## æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### 1. æ•°æ®å¤„ç†

- è‡ªåŠ¨è¯»å–`train_QA.csv`æ–‡ä»¶
- æå–`id`å’Œ`question`ä½œä¸ºæŸ¥è¯¢è¾“å…¥
- å¤„ç†`answer_value`å’Œ`ref_id`ä½œä¸ºè¯„ä¼°æ ‡å‡†

### 2. LightRAGæŸ¥è¯¢

- ä½¿ç”¨`/query`ç«¯ç‚¹è¿›è¡ŒæŸ¥è¯¢
- æŸ¥è¯¢æ ¼å¼ï¼š`{id}: {question}`
- é»˜è®¤ä½¿ç”¨`mix`æ¨¡å¼ï¼ŒåŒ…å«å‚è€ƒæ–‡çŒ®
- è‡ªåŠ¨æå–ç­”æ¡ˆå’Œå‚è€ƒæ–‡çŒ®ä¿¡æ¯

### 3. è¯„ä¼°æŒ‡æ ‡

#### ç­”æ¡ˆç›¸ä¼¼åº¦ (Answer Similarity)
- è®¡ç®—é¢„æµ‹ç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆçš„æ–‡æœ¬ç›¸ä¼¼åº¦
- æ”¯æŒåŒ…å«å…³ç³»æ£€æŸ¥å’Œè¯æ±‡é‡å åº¦è®¡ç®—
- åˆ†æ•°èŒƒå›´ï¼š0-1

#### å‚è€ƒæ–‡çŒ®å‡†ç¡®åº¦ (Reference Accuracy)
- ä»æ–‡ä»¶è·¯å¾„ä¸­æå–arXiv ID
- æ¯”è¾ƒé¢„æµ‹å‚è€ƒæ–‡çŒ®ä¸æ ‡å‡†å‚è€ƒæ–‡çŒ®çš„åŒ¹é…åº¦
- åˆ†æ•°èŒƒå›´ï¼š0-1

#### å‡†ç¡®ç‡ç»Ÿè®¡
- ç­”æ¡ˆå‡†ç¡®ç‡ï¼šç›¸ä¼¼åº¦ > 0.5 çš„æ ·æœ¬æ¯”ä¾‹
- å‚è€ƒæ–‡çŒ®å‡†ç¡®ç‡ï¼šå‡†ç¡®åº¦ > 0.5 çš„æ ·æœ¬æ¯”ä¾‹

### 4. ç»“æœè¾“å‡º

#### æ§åˆ¶å°è¾“å‡º
```
=====================================
æµ‹è¯•å®Œæˆ - æœ€ç»ˆç»Ÿè®¡ç»“æœ
=====================================
æ€»æ ·æœ¬æ•°: 10
æˆåŠŸæŸ¥è¯¢æ•°: 10
å¤±è´¥æŸ¥è¯¢æ•°: 0
å¹³å‡ç­”æ¡ˆç›¸ä¼¼åº¦: 0.654
ç­”æ¡ˆå‡†ç¡®ç‡ (ç›¸ä¼¼åº¦>0.5): 0.700
å¹³å‡å‚è€ƒæ–‡çŒ®å‡†ç¡®åº¦: 0.234
å‚è€ƒæ–‡çŒ®å‡†ç¡®ç‡ (å‡†ç¡®åº¦>0.5): 0.300
=====================================
```

#### CSVç»“æœæ–‡ä»¶
åŒ…å«æ¯ä¸ªæµ‹è¯•æ ·æœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼š
- é—®é¢˜IDå’Œå†…å®¹
- æ ‡å‡†ç­”æ¡ˆå’Œé¢„æµ‹ç­”æ¡ˆ
- ç›¸ä¼¼åº¦åˆ†æ•°
- å‚è€ƒæ–‡çŒ®å¯¹æ¯”
- æŸ¥è¯¢æ—¶é—´
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰

## é…ç½®é€‰é¡¹

åœ¨`test_lightrag_accuracy.py`ä¸­å¯ä»¥ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```python
# APIé…ç½®
api_base_url = "http://localhost:9621"

# æŸ¥è¯¢å‚æ•°
payload = {
    "query": f"{question_id}: {question}",
    "mode": "mix",                    # æŸ¥è¯¢æ¨¡å¼
    "include_references": True,       # åŒ…å«å‚è€ƒæ–‡çŒ®
    "response_type": "Multiple Paragraphs",
    "top_k": 10                      # æ£€ç´¢æ•°é‡
}

# æµ‹è¯•é…ç½®
max_samples = 10                    # æµ‹è¯•æ ·æœ¬æ•°
output_dir = "./results"           # è¾“å‡ºç›®å½•
```

## æ•…éšœæ’é™¤

### 1. APIæœåŠ¡è¿æ¥å¤±è´¥
```bash
Error: æ— æ³•è¿æ¥åˆ°APIæœåŠ¡
```
**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿LightRAGæœåŠ¡æ­£åœ¨è¿è¡Œï¼š`lightrag-server`
- æ£€æŸ¥æœåŠ¡åœ°å€ï¼š`http://localhost:9621`

### 2. CSVæ–‡ä»¶è¯»å–å¤±è´¥
```bash
Error: åŠ è½½CSVæ–‡ä»¶å¤±è´¥
```
**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿`train_QA.csv`æ–‡ä»¶å­˜åœ¨
- æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

### 3. ä¾èµ–åŒ…ç¼ºå¤±
```bash
ModuleNotFoundError: No module named 'requests'
```
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
pip3 install requests pandas
```

### 4. æŸ¥è¯¢è¶…æ—¶
å¦‚æœæŸ¥è¯¢ç»å¸¸è¶…æ—¶ï¼Œå¯ä»¥ï¼š
- å‡å°‘å¹¶å‘æ•°é‡
- å¢åŠ è¶…æ—¶æ—¶é—´
- æ£€æŸ¥LLMæœåŠ¡çŠ¶æ€

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰è¯„ä¼°é€»è¾‘

å¯ä»¥ä¿®æ”¹`calculate_answer_similarity`å’Œ`evaluate_reference_accuracy`æ–¹æ³•æ¥å®ç°è‡ªå®šä¹‰çš„è¯„ä¼°é€»è¾‘ã€‚

### æ‰¹é‡æµ‹è¯•

å¯¹äºå¤§è§„æ¨¡æµ‹è¯•ï¼Œå»ºè®®ï¼š
1. åˆ†æ‰¹è¿è¡Œï¼ˆæ¯æ¬¡50-100ä¸ªæ ·æœ¬ï¼‰
2. ç›‘æ§APIæœåŠ¡çŠ¶æ€
3. ä¿å­˜ä¸­é—´ç»“æœ

### ç»“æœåˆ†æ

ä½¿ç”¨pandasåˆ†æç»“æœï¼š
```python
import pandas as pd

# è¯»å–ç»“æœ
df = pd.read_csv('results/lightrag_test_results_*.csv')

# åˆ†æç­”æ¡ˆç›¸ä¼¼åº¦åˆ†å¸ƒ
print(df['answer_similarity'].describe())

# æŸ¥æ‰¾ä½åˆ†æ ·æœ¬
low_score = df[df['answer_similarity'] < 0.3]
print(low_score[['id', 'question', 'ground_truth_answer', 'predicted_answer']])
```

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªæµ‹è¯•å·¥å…·ï¼

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªLightRAGçš„è®¸å¯è¯ã€‚